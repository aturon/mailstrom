<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `mailstrom` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, mailstrom">

    <title>mailstrom - Rust</title>

    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'></p><script>window.sidebarCurrent = {name: 'mailstrom', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Crate <a class='mod' href=''>mailstrom</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../src/mailstrom/lib.rs.html#1-243' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Mailstrom handles email delivery in a background worker thread, with the following
features:</p>

<ul>
<li>Accepts an email from the caller and then does everything necessary to get it
delivered to all recipients without blocking the caller.</li>
<li>Allows the caller to query the status of an earlier submitted email at any time,
to determine if it is Queued, Delivered, Deferred, or has Failed, with details
as to why, on a per-recipient basis.</li>
<li>Handles all parsing, validation, and encoding of email content and headers,
in compliance with RFC 5322 (and other RFCs).  Uses the
<a href="https://github.com/mikedilger/email-format">email-format</a> library for this.</li>
<li>Looks up the DNS MX records of the recipients, and delivers directly to those Internet
mail servers over SMTP, thus not requiring any local SMTP relay.  Uses the
<a href="https://github.com/mikedilger/resolv-rs">resolv</a> library for DNS lookups (via your
operating system)</li>
<li>SMTP transport &quot;heavy lifting&quot; is performed via the <a href="https://github.com/lettre/lettre">lettre</a>
library.  Uses STARTTLS where available.</li>
<li>Retries with exponential backoff for a fixed number of retries (currently fixed at 3),
when the send result is Deferred</li>
<li>Uses a pluggable user-defined state management (persistence) layer.</li>
</ul>

<h2 id='limitations' class='section-header'><a href='#limitations'>Limitations</a></h2>
<ul>
<li>Only works on glibc based operating systems, due to usage of the <code>resolv</code> library.</li>
<li>The <a href="https://github.com/mikedilger/email-format">email-format</a> crate is somewhat incomplete
and clunky still.  It doesn&#39;t incorporate RFC 6854 (updated From and Sender syntax) yet.
It defines types one-to-one with ABNF parsing units, rather than as semantic units of meaning.
And it doesn&#39;t let you use obvious types yet like setting the date from a DateTime type.
However, these issues will be worked out in the near future.</li>
</ul>

<p>You can use it as follows:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>email_format</span>;
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>mailstrom</span>;

<span class='kw'>use</span> <span class='ident'>email_format</span>::<span class='ident'>Email</span>;
<span class='kw'>use</span> <span class='ident'>mailstrom</span>::{<span class='ident'>Mailstrom</span>, <span class='ident'>Config</span>, <span class='ident'>MemoryStorage</span>};

<span class='kw'>fn</span> <span class='ident'>main</span>() {
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>email</span> <span class='op'>=</span> <span class='ident'>Email</span>::<span class='ident'>new</span>(
        <span class='string'>&quot;myself@mydomain.com&quot;</span>,  <span class='comment'>// &quot;From:&quot;</span>
        <span class='string'>&quot;Wed, 05 Jan 2015 15:13:05 +1300&quot;</span> <span class='comment'>// &quot;Date:&quot;</span>
    ).<span class='ident'>unwrap</span>();

    <span class='ident'>email</span>.<span class='ident'>set_bcc</span>(<span class='string'>&quot;myself@mydomain.com&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_sender</span>(<span class='string'>&quot;from_myself@mydomain.com&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_reply_to</span>(<span class='string'>&quot;My Mailer &lt;no-reply@mydomain.com&gt;&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_to</span>(<span class='string'>&quot;You &lt;you@yourdomain.com&gt;, AndYou &lt;andyou@yourdomain.com&gt;&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_cc</span>(<span class='string'>&quot;Our Friend &lt;friend@frienddomain.com&gt;&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_subject</span>(<span class='string'>&quot;Hello Friend&quot;</span>).<span class='ident'>unwrap</span>();
    <span class='ident'>email</span>.<span class='ident'>set_body</span>(<span class='string'>&quot;Good to hear from you.\r\n\
                    I wish you the best.\r\n\
                    \r\n\
                    Your Friend&quot;</span>).<span class='ident'>unwrap</span>();

    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>mailstrom</span> <span class='op'>=</span> <span class='ident'>Mailstrom</span>::<span class='ident'>new</span>(
        <span class='ident'>Config</span> {
            <span class='ident'>helo_name</span>: <span class='string'>&quot;my.host.domainname&quot;</span>.<span class='ident'>to_owned</span>(),
            <span class='ident'>smtp_timeout_secs</span>: <span class='number'>30</span>,
        },
        <span class='ident'>MemoryStorage</span>::<span class='ident'>new</span>());

    <span class='comment'>// We must explicitly tell mailstrom to start actually sending emails.  If we</span>
    <span class='comment'>// were only interested in reading the status of previously sent emails, we</span>
    <span class='comment'>// would not send this command.</span>
    <span class='ident'>mailstrom</span>.<span class='ident'>start</span>().<span class='ident'>unwrap</span>();

    <span class='kw'>let</span> <span class='ident'>message_id</span> <span class='op'>=</span> <span class='ident'>mailstrom</span>.<span class='ident'>send_email</span>(<span class='ident'>email</span>).<span class='ident'>unwrap</span>();

    <span class='comment'>// Later on, after the worker thread has had time to process the request,</span>
    <span class='comment'>// you can check the status:</span>

    <span class='kw'>let</span> <span class='ident'>status</span> <span class='op'>=</span> <span class='ident'>mailstrom</span>.<span class='ident'>query_status</span>(<span class='kw-2'>&amp;</span><span class='op'>*</span><span class='ident'>message_id</span>).<span class='ident'>unwrap</span>();
    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;{:?}&quot;</span>, <span class='ident'>status</span>);
}</pre>
</div><h2 id='reexports' class='section-header'><a href="#reexports">Reexports</a></h2>
<table><tr><td><code>pub use status::<a class='struct' href='../mailstrom/status/struct.Status.html' title='mailstrom::status::Status'>Status</a>;</code></td></tr><tr><td><code>pub use status::<a class='enum' href='../mailstrom/status/enum.DeliveryResult.html' title='mailstrom::status::DeliveryResult'>DeliveryResult</a>;</code></td></tr></table><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='mod' href='error/index.html'
                                  title='mailstrom::error'>error</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='mod' href='internal_status/index.html'
                                  title='mailstrom::internal_status'>internal_status</a></td>
                           <td class='docblock-short'>
                                <p>This is exposed for implementers of <code>MailstromStorage</code> but otherwise should not
be needed by users of this library.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='mod' href='status/index.html'
                                  title='mailstrom::status'>status</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.Config.html'
                                  title='mailstrom::Config'>Config</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.Mailstrom.html'
                                  title='mailstrom::Mailstrom'>Mailstrom</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.MemoryStorage.html'
                                  title='mailstrom::MemoryStorage'>MemoryStorage</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='enum' href='enum.WorkerStatus.html'
                                  title='mailstrom::WorkerStatus'>WorkerStatus</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='trait' href='trait.MailstromStorage.html'
                                  title='mailstrom::MailstromStorage'>MailstromStorage</a></td>
                           <td class='docblock-short'>
                                <p>A trait for implementing Mailstrom storage</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='trait' href='trait.MailstromStorageError.html'
                                  title='mailstrom::MailstromStorageError'>MailstromStorageError</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "mailstrom";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    <script defer src="../search-index.js"></script>
</body>
</html>